#!/usr/bin/env bash

dna-get_public_ipv4() {

    ############################################################################

    while getopts ":s" arguments
    do
        case $arguments
        in
            s)	export silent="y"
                ;;
            \?)	dna-echo -e "Invalid option | ${n-}-${OPTARG}${r-} | for function | ${n-}${FUNCNAME[0]}${r-} |."
                dna-exit
                ;;
        esac
    done
    OPTIND=1

    ############################################################################

    if [ ! -f "${tmp_project_dir}/public_ipv4_setup" ]
    then

        describe_setting() {

            dna-echo -m "Now enter the public IPv4 of this machine that you'd like to use:"

        }

        hint_value() {

            apparent_public_ipv4="$(curl -s http://whatismyip.akamai.com/)"

            dna-echo -m "Your IPv4 public address appears to be: | ${y-}${apparent_public_ipv4}${n-} |."

            dna-ask_for_boolean -d "y" -q "Is this the correct public IPv4 you'd like to use for this machine?"

            if [ "${boolean_output}" = "y" ]
            then

                dna-echo -m "Ok, using this IPv4..."
                new_val="${apparent_public_ipv4}"

            else

                read -rp "${b-}Now specify your new value for option | ${o-}${option}${n-} | ${y-}${choices-}${n-}: ${x-}" new_val
                echo

            fi

        }

        validate_input() {

            dna-validate_ipv4 -s -i "${input}"

            if [ "${ip_is_valid}" = "y" ]
            then
                valid="y"
            else
                dna-echo -e "The value you specified does NOT appear to be a valid IPv4 address."
                valid="n"
            fi

            unset silent

        }

        dna-set_option -o "public_ipv4" -p "network" -d "y" -h "y" -v "y"

        touch "${tmp_project_dir}/public_ipv4_setup"

    else

        dna-echo -m "Public IPv4 for this machine previously set during this installation to: | ${y-}${public_ipv4}${n-} |."

    fi

    unset silent

}
